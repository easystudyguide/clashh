<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Clash Royale Prototype</title>
  <style>
    body { margin:0; background:#222; color:#fff; text-align:center; font-family:sans-serif; }
    canvas { background:#6fb6ff; display:block; margin:0 auto; border:2px solid #000; }
  </style>
</head>
<body>
  <h2>Clash Royale Prototype (Press 1 = top lane, 2 = bottom lane)</h2>
  <canvas id="gameCanvas" width="960" height="540"></canvas>
  <div>
    <strong>Your Elixir:</strong> <span id="elixirDisplay">5</span>
  </div>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    const elixirDisplay = document.getElementById("elixirDisplay");

    // --- Towers ---
    let towers = [
      // enemy side (red)
      {x: 860, y: 135, hp: 100, side:"enemy", type:"princess"},
      {x: 860, y: 405, hp: 100, side:"enemy", type:"princess"},
      {x: 910, y: 270, hp: 150, side:"enemy", type:"king"},

      // player side (blue)
      {x: 100, y: 135, hp: 100, side:"player", type:"princess"},
      {x: 100, y: 405, hp: 100, side:"player", type:"princess"},
      {x: 50,  y: 270, hp: 150, side:"player", type:"king"},
    ];

    // --- Units ---
    let units = [];

    class Unit {
      constructor(x, y, side, lane) {
        this.x = x;
        this.y = y;
        this.side = side;
        this.lane = lane;
        this.hp = 30;
        this.speed = side === "player" ? 1 : -1;
      }
      update() {
        this.x += this.speed;
        // check tower collision
        for (let t of towers) {
          if (t.side !== this.side && Math.abs(this.x - t.x) < 15 && Math.abs(this.y - t.y) < 40) {
            t.hp -= 0.2; // damage tower
          }
        }
      }
      draw() {
        ctx.fillStyle = this.side === "player" ? "blue" : "red";
        ctx.beginPath();
        ctx.arc(this.x, this.y, 10, 0, Math.PI*2);
        ctx.fill();
      }
    }

    // --- Elixir ---
    let playerElixir = 5;
    let enemyElixir = 5;
    setInterval(() => {
      if (playerElixir < 10) playerElixir++;
      if (enemyElixir < 10) enemyElixir++;
      elixirDisplay.textContent = playerElixir;
    }, 1000);

    // --- Player Controls ---
    window.addEventListener("keydown", e => {
      if (e.code === "Digit1" && playerElixir >= 3) {
        units.push(new Unit(160, 135, "player", "top"));
        playerElixir -= 3;
      }
      if (e.code === "Digit2" && playerElixir >= 3) {
        units.push(new Unit(160, 405, "player", "bottom"));
        playerElixir -= 3;
      }
    });

    // --- Enemy AI ---
    setInterval(() => {
      if (enemyElixir >= 3) {
        let lane = Math.random() > 0.5 ? 135 : 405;
        units.push(new Unit(800, lane, "enemy", lane === 135 ? "top":"bottom"));
        enemyElixir -= 3;
      }
    }, 3000);

    // --- Game Loop ---
    function gameLoop() {
      ctx.clearRect(0,0,canvas.width,canvas.height);

      // Draw arena lanes
      ctx.strokeStyle = "white";
      ctx.beginPath();
      ctx.moveTo(0,270);
      ctx.lineTo(960,270);
      ctx.stroke();

      // Draw towers
      for (let t of towers) {
        ctx.fillStyle = t.side === "player" ? "blue" : "red";
        ctx.fillRect(t.x-20, t.y-40, 40, 80);
        ctx.fillStyle = "white";
        ctx.fillText(t.type.toUpperCase()+" "+Math.floor(t.hp), t.x-30, t.y-50);
      }

      // Update + draw units
      for (let u of units) {
        u.update();
        u.draw();
      }

      // Check win/lose
      let enemyKing = towers.find(t => t.side==="enemy" && t.type==="king");
      let playerKing = towers.find(t => t.side==="player" && t.type==="king");

      if (enemyKing.hp <= 0) {
        ctx.fillStyle = "yellow";
        ctx.font = "48px sans-serif";
        ctx.fillText("YOU WIN!", 360, 100);
        return;
      } 
      if (playerKing.hp <= 0) {
        ctx.fillStyle = "yellow";
        ctx.font = "48px sans-serif";
        ctx.fillText("YOU LOSE!", 360, 100);
        return;
      }

      requestAnimationFrame(gameLoop);
    }

    gameLoop();
  </script>
</body>
</html>
